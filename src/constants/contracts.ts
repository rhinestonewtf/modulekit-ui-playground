import { Hex } from "viem";
import { Account } from "../domains/Account";
import { Validator } from "../domains/Module/Module";
import { signUserOpHash } from "../domains/UserOperation/api/signUserOp";
import { signMessage } from "@wagmi/core";
import { wagmiConfig } from "../app/(app)/Providers";

export type ContractDependencies = {
  [name: string]: Hex;
};

export type ValidatorList = {
  [name: string]: Validator;
};

export const validators: ValidatorList = {
  ecdsa: {
    name: "ecdsa",
    address: "0x19826F42C27961355b652daAC8282b85BD5b1cF9",
    mockSignature:
      "0xe8b94748580ca0b4993c9a1b86b5be851bfc076ff5ce3a1ff65bf16392acfcb800f9b4f1aef1555c7fce5599fffb17e7c635502154a0333ba21f3ae491839af51c",
    signMessageAsync: async (message: Hex, activeAccount: Account) => {
      return await signMessage(wagmiConfig, { message: { raw: message } });
    },
  },
  webauthn: {
    name: "webauthn",
    address: "0xB236CDE7e68431D874FD90E10b1910af5DC45DAc",
    mockSignature:
      "0x07855b46a623a8ecabac76ed697aa4e13631e3b6718c8a0d342860c13c30d2fc00000000000000000000000000000000000000000000000000000000000000e0010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001400000000000000000000000000000000000000000000000000000000000000024456b4f30bac4a8994b010d127650e6f22669f7f7aec4475f80f8c2a8d2ed02872b0aca713e929d8a28596b42f325fa9587a16a8eb2bc07e4b3a3e9c14a7b988100000000000000000000000000000000000000000000000000000000000000251584482fdf7a4d0b7eb9d45cf835288cb59e55b8249fff356e33be88ecc546d11d0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000957b2274797065223a22776562617574686e2e676574222c226368616c6c656e6765223a22307831383138356261383531633032383032323035366564396634326261313434396532613138663739323932326238383939363937313962616665373861653563222c226f726967696e223a2268747470733a2f2f646576656c6f706d656e742e666f72756d64616f732e636f6d227d0000000000000000000000",
    signMessageAsync: async (message: Hex, activeAccount: Account) => {
      return await signUserOpHash(message, activeAccount);
    },
  },
};

export const contracts: ContractDependencies = {
  // CORE
  ENTRY_POINT_ADDRESS: "0x0000000071727De22E5E9d8BAf0edAc6f37da032",
  ACCOUNT_FACTORY_ADDRESS: "0xDC15682AEDba36Cf3121507993b50Ef22b457053",
  SINGLETON_ADDRESS: "0xa951A1179bA8bd08b8140aB9dc7910AF08AE7181",
  REGISTRY_ADDRESS: "0x000000000069E2a187AEFFb852bF3cCdC95151B2",

  // MODULES
  ECDSA_VALIDATOR_ADDRESS: "0x19826F42C27961355b652daAC8282b85BD5b1cF9", // ownable validator
  WEBAUTHN_VALIDATOR_ADDRESS: "0xB236CDE7e68431D874FD90E10b1910af5DC45DAc",

  // UTILITIES
  BOOTSTRAP_ADDRESS: "0x1E919660050C68BFEf868945Cf5f9a26ad7E360b",
};
